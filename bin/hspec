#!/bin/sh

opts='--color --format=progress'
flags='-isrc -itest -fdefer-type-errors'

case $# in
  0)
    if [ -f 'Spec.hs' ]; then
      runhaskell $flags Spec.hs $opts
    elif [ -f 'test/Spec.hs' ]; then
      runhaskell $flags test/Spec.hs $opts
    else
      echo "No tests found"
      exit 1
    fi
    ;;
  *)
    [ -d 'src' ] && flags+=' -isrc'
    while [ "$1" != "" ]; do
      if [ -f $1 ]; then
        runhaskell $flags $1 $opts
        shift
      else
        echo "$1: No such file"
        exit 1
      fi
    done
    ;;
esac
